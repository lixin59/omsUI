var se=Object.defineProperty,ue=Object.defineProperties;var le=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var L=(e,o,n)=>o in e?se(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n,E=(e,o)=>{for(var n in o||(o={}))re.call(o,n)&&L(e,n,o[n]);if(I)for(var n of I(o))ie.call(o,n)&&L(e,n,o[n]);return e},x=(e,o)=>ue(e,le(o));import{e as u,d as c,j as t,k as B,F as ce,m as q,a5 as O,a4 as de}from"./vendor.3adfed64.js";import{D as pe,c as ge}from"./DialogActions.9747b884.js";import{D as he,T as be,F as me}from"./IconButton.cc13632c.js";import{T as k}from"./TextField.84619a02.js";import{b as y,I as J,S as N,M as j,P as Fe}from"./MenuItem.fff0d7f8.js";import{r as Ce,s as Be,t as ve,u as fe,a as W,v as De,w as Ee,x as xe}from"./httpRequestApi.785f0199.js";import{T as ke,a as ye,b as Ae,c as z,d as v,e as je,f as we}from"./TableRow.db7565dc.js";import{a as S}from"./action.c965c132.js";import"./Typography.3f3c5a2b.js";import"./KeyboardArrowRight.75cb1df8.js";import"./index.374d7e98.js";const M=e=>({root:{flexGrow:1,display:"flex",height:"100%",width:"100%",indicator:{"& > span":{maxWidth:40,width:"100%",backgroundColor:"#4bce21"}}},itemPage:{width:"100%",height:"100%"},ControlBox:{marginBottom:"20px",width:"100%",display:"flex",alignContent:"space-evenly",alignItems:"center",justifyContent:"space-between"},Control:{width:"15%"},shellBox:{width:"100%",height:"90%"},TabPanel:{height:"100%",width:"100%"},tabs:{width:"240px",borderRight:`1px solid ${e.palette.divider}`},rootTable:{width:"100%",height:"100%"},container:{height:"92%"},deleteButton:{marginRight:"14px",backgroundColor:e.palette.error[e.palette.type],"&:hover":{backgroundColor:e.palette.error.main}},editBtn:{marginRight:"14px",backgroundColor:e.palette.warning[e.palette.type],"&:hover":{backgroundColor:e.palette.warning.main}},starBtn:{marginRight:"14px",backgroundColor:e.palette.primary[e.palette.type],"&:hover":{backgroundColor:e.palette.primary.main}},reStarBtn:{marginRight:"14px",backgroundColor:e.palette.info[e.palette.type],"&:hover":{backgroundColor:e.palette.info.main}},stopBtn:{marginRight:"14px",backgroundColor:e.palette.secondary[e.palette.type],"&:hover":{backgroundColor:e.palette.secondary.main}},addButton:{backgroundColor:e.palette.success[e.palette.type],"&:hover":{backgroundColor:e.palette.success.main}}});function Te({open:e=!1,title:o,text:n="",toClose:d}){const i=u.exports.useRef(null);u.exports.useEffect(()=>{try{const l=i.current;l.scrollTop=l.scrollHeight}catch(l){console.log(l)}},[n,i]);const m=()=>{d&&d()};return c(pe,{open:e,onClose:m,fullWidth:!0,maxWidth:"md",children:[t(he,{style:{backgroundColor:"#ffe2c0"},children:o}),t("div",{ref:i,style:{whiteSpace:"pre-wrap",wordWrap:"break-word",paddingLeft:"20px",overflow:"auto"},children:n}),t(ge,{children:t(B,{onClick:m,style:{backgroundColor:"#ec5353"},children:"\u786E\u5B9A"})})]})}const Se=({Info:e,setInfo:o})=>c(ce,{children:[t(k,{autoFocus:!0,margin:"dense",id:"job-name",label:"job\u540D\u79F0",fullWidth:!0,value:e.name,onChange:n=>o(x(E({},e),{name:n.target.value}))}),t(k,{autoFocus:!0,margin:"dense",id:"job-spec",label:"cron\u8868\u8FBE\u5F0F",fullWidth:!0,value:e.spec,onChange:n=>o(x(E({},e),{spec:n.target.value}))}),t(k,{autoFocus:!0,margin:"dense",id:"job-cmd",label:"\u547D\u4EE4",fullWidth:!0,value:e.cmd,onChange:n=>o(x(E({},e),{cmd:n.target.value}))}),c(y,{style:{width:"100%"},children:[t(J,{id:"job-select-label",children:"\u9009\u62E9job\u7C7B\u578B"}),c(N,{labelId:"job-select-label",id:"job-select",value:e.type,onChange:n=>o(x(E({},e),{type:n.target.value})),children:[t(j,{value:"cron",children:"cron"}),t(j,{value:"task",children:"task"})]})]})]}),Pe=[{id:"name",label:"job\u540D\u79F0",minWidth:100},{id:"type",label:"job\u7C7B\u578B",minWidth:100},{id:"spec",label:"cron\u8868\u8FBE\u5F0F",minWidth:100},{id:"cmd",label:"\u547D\u4EE4",minWidth:100},{id:"status",label:"\u72B6\u6001",minWidth:100},{id:"density",label:"\u64CD\u4F5C",minWidth:100}];function $e({deleteJob:e,jobList:o,editJob:n}){const d=q(M)(),{enqueueSnackbar:i}=O(),[m,l]=u.exports.useState(0),[h,f]=u.exports.useState(10),[P,A]=u.exports.useState(!1),[$,D]=u.exports.useState(!1),[C,w]=u.exports.useState(null),[p,F]=u.exports.useState({id:0,name:"",type:"cron",spec:"",cmd:"",status:"",host_id:0}),[R,T]=u.exports.useState(!1),[s,H]=u.exports.useState(""),_="\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u4E2A\u4EFB\u52A1\u5417\uFF1F",G="\u5982\u679C\u4E0D\u60F3\u5220\u9664\u53EF\u4EE5\u70B9\u51FB\u53D6\u6D88",K=Se({Info:p,setInfo:F}),U=async a=>{const{id:g,name:r}=a,b=await ve(g);if(n(b.data),b.code!=="200"){i(`\u4EFB\u52A1: ${r} \u542F\u52A8\u5931\u8D25${b.msg}`,{autoHideDuration:3e3,variant:"error"});return}i(`\u4EFB\u52A1: ${r} \u542F\u52A8\u6210\u529F${b.msg}`,{autoHideDuration:3e3,variant:"success"})},Q=async a=>{const{id:g,name:r}=a,b=await fe(g);if(b.code!=="200"){i(`\u4EFB\u52A1: ${r} \u505C\u6B62\u5931\u8D25${b.msg}`,{autoHideDuration:3e3,variant:"error"});return}n(b.data),i(`\u4EFB\u52A1: ${r} \u505C\u6B62\u6210\u529F${b.msg}`,{autoHideDuration:3e3,variant:"success"})},V=a=>{C&&C.cancel("Operation canceled due to new request.");const g=W.CancelToken.source();w(g),W.get(a,{onDownloadProgress:r=>{const b=r.currentTarget.response;H(b)},cancelToken:g.token}).catch(r=>{W.isCancel(r)?console.log("Request canceled",r):console.log(r)})},X=async a=>{const{id:g}=a,r=De(g);V(r),T(!0)},Y=u.exports.useCallback(async()=>{const a=await Ce(p);if(a.code!=="200"){i(`\u4EFB\u52A1: ${p.name}\u4FEE\u6539\u5931\u8D25${a.msg}`,{autoHideDuration:3e3,variant:"error"});return}n(a.data),i(`\u4EFB\u52A1: ${p.name} \u4FEE\u6539\u6210\u529F${a.msg}`,{autoHideDuration:3e3,variant:"success"})},[p]),Z=a=>{F(a),A(!0)},ee=()=>{A(!1)},te=u.exports.useCallback(async()=>{const a=await Be(p.id);if(a.code!=="200"){i(`\u4EFB\u52A1: ${p.name}\u5220\u9664\u5931\u8D25${a.msg}`,{autoHideDuration:3e3,variant:"error"});return}e(p.id),i(`\u4EFB\u52A1: ${p.name} \u5DF2\u88AB\u5220\u9664`,{autoHideDuration:3e3,variant:"success"})},[p]),ae=(a,g)=>{l(g)},oe=a=>{f(+a.target.value),l(0)},ne=u.exports.useCallback(()=>{C&&C.cancel("cancel http"),T(!1)},[C]);return c(Fe,{className:d.rootTable,children:[t(ke,{className:d.container,children:c(ye,{stickyHeader:!0,"aria-label":"sticky table",children:[t(Ae,{children:t(z,{children:Pe.map(a=>t(v,{align:"center",style:{minWidth:a.minWidth},children:a.label},a.id))})}),t(je,{children:o&&o.slice(m*h,m*h+h).map(a=>c(z,{hover:!0,role:"checkbox",tabIndex:-1,children:[t(v,{align:"center",children:a.name},a.name),t(v,{align:"center",children:a.type},a.type),t(v,{align:"center",children:a.spec},a.spec),t(v,{align:"center",children:a.cmd},a.cmd),t(v,{align:"center",children:a.status},a.status),c(v,{align:"center",children:[t(B,{className:d.editBtn,onClick:()=>{F(a),D(!0)},children:"\u7F16\u8F91"}),t(B,{className:d.deleteButton,onClick:()=>Z(a),children:"\u5220\u9664"}),t(B,{className:d.starBtn,onClick:()=>U(a),children:"\u542F\u52A8"}),t(B,{className:d.stopBtn,onClick:()=>Q(a),children:"\u505C\u6B62"}),t(B,{className:d.reStarBtn,onClick:()=>X(a),children:"\u65E5\u5FD7"})]})]},a.name))})]})}),t(we,{rowsPerPageOptions:[10,25,100],component:"div",labelRowsPerPage:t("div",{children:"\u6BCF\u9875\u884C\u6570:"}),labelDisplayedRows:({from:a,to:g,count:r})=>`${a}-${g} \u603B\u6570 ${r!==-1?r:0}`,count:o.length,rowsPerPage:h,page:m,onPageChange:ae,onRowsPerPageChange:oe}),t(Te,{open:R,title:"\u67E5\u770B\u65E5\u5FD7",text:s,toClose:ne}),t(be,{open:P,title:_,text:G,toClose:ee,todo:te}),t(me,{open:$,content:K,toClose:()=>D(!1),title:"\u7F16\u8F91Job\u4FE1\u606F",todo:Y})]})}const Re=(e,o)=>x(E({},o),{jobList:e.jobList,hostList:e.hostList}),He={toInit:S.initJobInfo,deleteJob:S.deleteJobInfo,addJob:S.addJobInfo,editJob:S.editJobInfo},Je=({hostList:e,jobList:o,addJob:n,editJob:d,deleteJob:i,toInit:m})=>{u.exports.useEffect(()=>{(async()=>{const s=await Ee();s.code==="200"&&m(s.data)})()},[]);const l=q(M)(),{enqueueSnackbar:h}=O(),[f,P]=u.exports.useState(""),[A,$]=u.exports.useState(""),[D,C]=u.exports.useState(""),[w,p]=u.exports.useState(""),[F,R]=u.exports.useState(""),T=async()=>{if(f===""){h("\u8BF7\u9009\u62E9\u4E00\u4E2A\u7C7B\u578B\uFF01",{autoHideDuration:3e3,variant:"warning"});return}if(f==="cron"&&!D){h("\u9009\u4E2Dcron\u7C7B\u578B, cron\u8868\u8FBE\u5F0F\u4E0D\u80FD\u4E3A\u7A7A\uFF01",{autoHideDuration:3e3,variant:"warning"});return}if(!F){h("job\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A\uFF01",{autoHideDuration:3e3,variant:"warning"});return}if(o.some(H=>H.name===F)){h("\u8BE5Job\u5DF2\u5B58\u5728\uFF01",{autoHideDuration:3e3,variant:"warning"});return}const s=await xe({name:F,type:f,spec:D,cmd:w,host_id:A});if(s.code!=="200"){h(`\u6DFB\u52A0\u4EFB\u52A1\u5931\u8D25${s.msg}`,{autoHideDuration:3e3,variant:"error"});return}n(s.data),h(`\u4EFB\u52A1\uFF1A${s.data.name} \u6DFB\u52A0\u6210\u529F${s.msg}`,{autoHideDuration:3e3,variant:"success"})};return c("div",{className:l.itemPage,children:[c("div",{className:l.ControlBox,children:[c(y,{className:l.Control,children:[t(J,{id:"job-select-label",children:"\u9009\u62E9job\u7C7B\u578B"}),c(N,{labelId:"job-select-label",id:"job-select",value:f,onChange:s=>P(s.target.value),children:[t(j,{value:"cron",children:"cron"}),t(j,{value:"task",children:"task"})]})]}),c(y,{className:l.Control,children:[t(J,{id:"hostid-select-label",children:"\u9009\u62E9\u4E3B\u673A"}),t(N,{labelId:"hostid-select-label",id:"hostid-select",value:A,onChange:s=>$(s.target.value),children:e.map(s=>t(j,{value:s.id,children:s.name},s.id))})]}),t(y,{className:l.Control,children:t(k,{size:"small",id:"cron-job",label:"cron\u8868\u8FBE\u5F0F",variant:"outlined",value:D,placeholder:"task\u7C7B\u578B\u4E0D\u7528\u6DFB\u52A0\u89C4\u5219",onChange:s=>C(s.target.value)})}),t(y,{className:l.Control,children:t(k,{size:"small",label:"Job\u540D\u79F0",id:"name-job",variant:"outlined",value:F,onChange:s=>R(s.target.value)})}),t(y,{className:l.Control,children:t(k,{size:"small",label:"\u547D\u4EE4",id:"cmd-job",variant:"outlined",value:w,onChange:s=>p(s.target.value)})}),t(B,{className:l.addButton,onClick:T,children:"\u589E\u52A0\u4EFB\u52A1"})]}),t("div",{className:l.shellBox,children:t($e,{jobList:o,deleteJob:i,editJob:d})})]})};var Qe=de(Re,He)(Je);export{Qe as default};
